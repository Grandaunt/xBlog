<!DOCTYPE html>
<html>
<head lang="en">
<meta charset="UTF-8">
<link href="/css/bootstrap-theme.min.css" rel="stylesheet"
	type="text/css" />
<link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="/css/bootstrap-combined.min.css" rel="stylesheet"
	type="text/css" media="screen" />
<link href="/css/font-awesome.css" rel="stylesheet" type="text/css" />
<link href="/css/default-home.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="/images/Home.ico" />
<script type="text/javascript" src="/js/jquery-2.2.3.min.js"></script>
<script type="text/javascript" src="/js/jquery-ui.js"></script>
<script type="text/javascript" src="/js/default-main.js"></script>
<script type="text/javascript" src="/js/jquery.base64.js"></script>
<title>心有猛虎，细嗅蔷薇</title>
</head>
<body>

	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				<div id="logoutArea" style="display: none;">
					<p class="navbar-text pull-right">
						<a href="#" id="userDisplayName" class="navbar-link">null</a>
						<button id="logout" class="btn btn-link">注销</button>
					</p>
					<div class="navbar-text  pull-right">欢迎回来！&nbsp&nbsp</div>
				</div>
				<div id="login_register">
					<p class="navbar-text pull-right">
						<a href="../../login" class="navbar-link">登录</a> <a
							href="../../register" class="navbar-link">注册</a>
					</p>
				</div>
				<h3>心有猛虎，细嗅蔷薇</h3>
				<ul class="breadcrumb">
					<li><a href="../../index">主页</a> <span class="divider">/</span>
					</li>
					<li><a href="../../index">Blog</a> <span class="divider">/</span>
					</li>
					<li id="articleTitle" class="active">新文章</li>
				</ul>
			</div>
		</div>
	</div>

	<div class="content">
		<div class="container-fluid">
			<div id='pad-wrapper'>
				<div id="divError" class="clsError"></div>
				<div>
					<p class="navbar-text pull-right">
						<input id="titles" type="text" class="input-block-level"
							placeholder="文章标题">
						<button id="preview" class="btn-primary">预览文章</button>
						<button id="publish" class="btn-primary">保存文章</button>
					</p>
				</div>
				<div id="editparent">
					<div id='editControls' class='span12'
						style='text-align: left; padding: 5px;'>
						<div class='btn-group'>
							<a class='btn' data-role='undo' href='#'><i class='icon-undo'></i></a>
							<a class='btn' data-role='redo' href='#'><i
								class='icon-repeat'></i></a>
						</div>
						<div class='btn-group'>
							<a class='btn' data-role='bold' href='#'><b>Bold</b></a> <a
								class='btn' data-role='italic' href='#'><em>Italic</em></a> <a
								class='btn' data-role='underline' href='#'><u><b>U</b></u></a> <a
								class='btn' data-role='strikeThrough' href='#'><strike>abc</strike></a>
						</div>
						<div class='btn-group'>
							<a class='btn' data-role='justifyLeft' href='#'><i
								class='icon-align-left'></i></a> <a class='btn'
								data-role='justifyCenter' href='#'><i
								class='icon-align-center'></i></a> <a class='btn'
								data-role='justifyRight' href='#'><i
								class='icon-align-right'></i></a> <a class='btn'
								data-role='justifyFull' href='#'><i
								class='icon-align-justify'></i></a>
						</div>
						<div class='btn-group'>
							<a class='btn' data-role='indent' href='#'><i
								class='icon-indent-right'></i></a> <a class='btn'
								data-role='outdent' href='#'><i class='icon-indent-left'></i></a>
						</div>
						<div class='btn-group'>
							<a class='btn' data-role='insertUnorderedList' href='#'><i
								class='icon-list-ul'></i></a> <a class='btn'
								data-role='insertOrderedList' href='#'><i
								class='icon-list-ol'></i></a>
						</div>
						<div class='btn-group'>
							<a class='btn' data-role='h1' href='#'>h<sup>1</sup></a> <a
								class='btn' data-role='h2' href='#'>h<sup>2</sup></a> <a
								class='btn' data-role='p' href='#'>p</a> <a class='btn'
								data-role='pre' href='#'>code</a>
						</div>
						<div class='btn-group'>
							<a class='btn' data-role='subscript' href='#'><i
								class='icon-subscript'></i></a> <a class='btn'
								data-role='superscript' href='#'><i class='icon-superscript'></i></a>
						</div>
					</div>
					<div id='editor' class='span12' style='' contenteditable></div>
				</div>
			</div>
		</div>
	</div>

	<script>
		$(document)
				.ready(
						function() {
							$('#editControls a').click(
									function(e) {
										switch ($(this).data('role')) {
										case 'h1':
										case 'h2':
										case 'p':
										case 'pre':
											document.execCommand('formatBlock',
													false, '<'
															+ $(this).data(
																	'role')
															+ '>');
											break;
										default:
											document.execCommand($(this).data(
													'role'), false, null);
											break;
										}

									});
							var id = $.simpleBlog.getPublishId();
							if (id) {
								$
										.ajax({
											url : "../../api/articles/" + id,
											type : "GET",
											dataType : 'json',
											data : {
												"id" : id
											},
											success : function(data) {
												$("#articleTitle").text(
														data.articleTitle);
												$("#titles").val(
														data.articleTitle);
												$("#editor").html(
														data.articleContent);
											},
											complete : function(XMLHttpRequest,
													textStatus) {
											},
											error : function(XMLHttpRequest,
													textStatus, errorThrown) {
												$("#divError")
														.show()
														.html(
																XMLHttpRequest.responseJSON.message);
											}
										});
								$("#publish")
										.click(
												function() {
													var text = $("#editor")
															.html();
													var title = $("#titles")
															.val();
													$
															.ajax({
																url : "../../api/articles/"
																		+ id,
																type : "PUT",
																dataType : 'json',
																data : {
																	"articleTitle" : title,
																	"articleContent" : text
																},
																success : function(
																		data) {
																	$(
																			"#divError")
																			.show()
																			.html(
																					"OK!");
																},
																error : function(
																		XMLHttpRequest,
																		textStatus,
																		errorThrown) {
																	$(
																			"#divError")
																			.show()
																			.html(
																					XMLHttpRequest.responseJSON.message);
																},
																complete : function(
																		XMLHttpRequest,
																		textStatus) {
																}
															});
												});
							} else {
								$("#publish")
										.click(
												function() {
													var text = $("#editor")
															.html();
													var title = $("#titles")
															.val();
													$
															.ajax({
																url : "../../api/articles",
																type : "post",
																dataType : 'json',
																data : {
																	"articleTitle" : title,
																	"articleContent" : text
																},
																success : function(
																		data) {
																	$(
																			"#divError")
																			.show()
																			.html(
																					"OK");
																},
																error : function(
																		XMLHttpRequest,
																		textStatus,
																		errorThrown) {
																	$(
																			"#divError")
																			.show()
																			.html(
																					XMLHttpRequest.responseJSON.message);
																},
																complete : function(
																		XMLHttpRequest,
																		textStatus) {
																}
															});
												});
							}
							$.simpleBlog.refreshUserNameArea();
						});
	</script>
</body>
</html>